---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document: 
    keep_md: yes
---

```{r echo=FALSE,warning=FALSE}
library(knitr)
opts_chunk$set(echo=TRUE, message=FALSE, warning=FALSE, fig.height = 4, fig.width = 8, fig.align='center')
```
## Loading and preprocessing the data

#### 1. Loading packages and data.

```{r}
library(dplyr)
library(lubridate)
library(lattice)
unzip("activity.zip")
data <- read.csv(file = "activity.csv")
```

#### 2. Transforming dates from char to date.

```{r}
data$date <- as.Date(data$date)
```
----

## What is mean total number of steps taken per day?

#### 1. Histogram of the total number of steps taken each day.

* #### Group data by date and summarize sum of steps for each date.

```{r}
aux <- data %>% group_by(date) %>% summarize(tsteps = sum(steps, na.rm = FALSE))
```

* #### Histogram of the total number of steps taken each day.

```{r}
hist(aux$tsteps, xlab = "Number of steps per day", ylab = "Frequency of days", main = "")
```

#### 2. The mean and median number of steps taken by date.

```{r}
data %>% group_by(date) %>% summarize(means = mean(steps, na.rm = FALSE),medians = median(steps,  na.rm = FALSE))
```

#### 3. Totals for mean and median number of steps taken per day.

```{r}
data %>% summarise(total_mean = mean(steps, na.rm = TRUE), total_median = median(steps,na.rm = TRUE))
```
----

## What is the average daily activity pattern?

#### 1. Time series plot of the 5-minute interval (x-axis) and the average number of steps taken (y-axis), averaged across all days.

* #### Calculating mean number of steps taken for each time interval.

```{r}
aux <- data %>% group_by(interval) %>% summarize(msteps = mean(steps, na.rm = TRUE))

```

* #### Plotting time series graph.

```{r}
plot(aux$interval,aux$msteps,type = "l",ylab = "Average number of steps", xlab = "5-minute intervals")
```

#### 2. Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?

* #### Subsetting row that corresponds to maximum average number of steps (interval 835).

```{r}
aux[aux$msteps == max(aux$msteps),]
```
----

## Imputing missing values

#### 1. Total number of missing values in the dataset (i.e. the total number of rows with NAs).

```{r}
sum(!complete.cases(data))
```

#### 2. Strategy for filling in all of the missing values in the dataset: Using the mean for the 5-minute interval as integer.

```{r}
dataclean <- data
for(i in 1:nrow(dataclean)){
    if(is.na(dataclean$steps[i])){
        fill<- as.integer(aux[aux$interval==dataclean$interval[i],]$msteps)
        dataclean$steps[i] <- fill
    }
}
```

#### 3. New dataset with the missing data filled in.

```{r}
head(dataclean,10)
```

#### 4. Histogram of the total number of steps taken each day and the **mean** and **median** total number of steps taken per day. Do these values differ from the estimates from the first part of the assignment? What is the impact of imputing missing data on the estimates of the total daily number of steps?

* #### Histogram of the total number of steps taken each day.

```{r}
aux <- dataclean %>% group_by(date) %>% summarize(tsteps = sum(steps))
```

```{r}
hist(aux$tsteps, xlab = "Number of steps per day", ylab = "Frequency of days", main = "")
```

* #### The mean and median number of steps taken by date.

```{r}
dataclean %>% group_by(date) %>% summarize(means = mean(steps),medians = median(steps))
```

* #### Totals for mean and median number of steps taken per day.

```{r}
dataclean %>% summarise(total_mean = mean(steps), total_median = median(steps))
```

> Overall shape of histogram did not change. Peak of the graph increased from just over 25 in the first graph to over 30 in the graph with the NAs filled in. Totals for the mean and median did not change significantly.   

----

## Are there differences in activity patterns between weekdays and weekends?

#### 1. Create a new factor variable in the dataset with two levels indicating whether a given date is a weekday or weekend day.

* #### Mapping weekends (TRUE) and weekdays (FALSE) to logical vector.

```{r}
vet <- sapply(data$date,function(e){
        wd <- wday(e)
        if(wd == 1  || wd == 7) TRUE
        else FALSE })
```

* #### Adding new variable named wkend containing logical vector as factor. 

```{r}
data$wkend <- factor(vet)

```

* #### Splitting data according to wkend.

```{r}
dlist <- split(data, data$wkend)
```

* #### Calculating mean number of steps per time interval for each dataframe in the list and merging the two.

```{r}
dlist$'FALSE' <- dlist$'FALSE' %>% group_by(interval) %>% summarize(msteps = mean(steps, na.rm = TRUE))
dlist$'FALSE' <- cbind.data.frame(dlist$'FALSE',wkend = "weekday")
dlist$'TRUE' <- dlist$'TRUE' %>% group_by(interval) %>% summarize(msteps = mean(steps, na.rm = TRUE))
dlist$'TRUE' <- cbind.data.frame(dlist$'TRUE', wkend = "weekend")
final <- rbind.data.frame(dlist$'FALSE',dlist$'TRUE')
```

#### 2. Panel plot containing a time series plot of the 5-minute interval (x-axis) and the average number of steps taken (y-axis), averaged across all weekday days or weekend days.

```{r}
xyplot(msteps ~ interval | wkend ,data = final, type = "l", layout = c(1,2), ylab = "Number of steps", xlab = "Interval")
```

----

